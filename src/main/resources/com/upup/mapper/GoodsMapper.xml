<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.upup.sale.mapper.GoodsMapper" >
  <resultMap id="BaseResultMap" type="com.upup.sale.model.Goods" >
    <constructor >
      <idArg column="UUID" jdbcType="INTEGER" javaType="java.lang.Integer" />
      <arg column="NAME" jdbcType="VARCHAR" javaType="java.lang.String" />
      <arg column="ORIGIN" jdbcType="VARCHAR" javaType="java.lang.String" />
      <arg column="PRODUCER" jdbcType="VARCHAR" javaType="java.lang.String" />
      <arg column="UNIT" jdbcType="VARCHAR" javaType="java.lang.String" />
      <arg column="INPRICE" jdbcType="REAL" javaType="java.lang.Float" />
      <arg column="OUTPRICE" jdbcType="REAL" javaType="java.lang.Float" />
      <arg column="GOODSTYPEUUID" jdbcType="INTEGER" javaType="java.lang.Integer" />
    </constructor>
  </resultMap>
  <sql id="Base_Column_List" >
    UUID, NAME, ORIGIN, PRODUCER, UNIT, INPRICE, OUTPRICE, GOODSTYPEUUID
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    select 
    <include refid="Base_Column_List" />
    from goods
    where UUID = #{uuid,jdbcType=INTEGER}
  </select>
  <select id="queryNameAll" resultType="com.upup.sale.model.Goods">
    select
   *
    from goods
  </select>

  <!---->
    <select id="queryBynameAll" resultType="com.upup.model.Store">
    select * from store where sys_empUUID =
(select uuid from sys_emp where name =#{name})
    </select>

  <select id="queryStateList" resultType="java.lang.Integer">
    select state as a from orderdetail where ordersuuid =#{ordersuuid} group by a
  </select>


  <select id="querySupplierAllList" resultType="com.upup.model.Supplier">
    select * from supplier where type =2
  </select>

  <select id="getBygoodesname" resultType="com.upup.sale.model.Goods">
    select * from goods where name =#{goodname}
  </select>

  <select id="selectByid" resultType="com.upup.purchase.model.Orderdetail">
    select * from orderdetail where uuid = #{uuid}
  </select>

  <select id="selectByorderid" resultType="com.upup.purchase.model.Returnorders">
    select * from Returnorders where WAYBILLSN = #{orderuuid}
  </select>

  <select id="selectsuppGetByname" resultType="java.lang.Integer">
    select uuid from supplier where  name =#{suppliername}
  </select>


  <select id="queryReturnorderdetailAllList" resultType="java.util.Map">
select o.uuid,date_format(o.createtime,'%Y-%m-%d %H:%i:%s') as createtime,
             date_format(o.checktime,'%Y-%m-%d %H:%i:%s') as checktime,
             date_format(o.endtime,'%Y-%m-%d %H:%i:%s') as endtime, u1.name as creatername,u2.name as checkername ,u3.name as endername ,s1.name as suppliername,o.TOTALMONEY,o.STATE,o.WAYBILLSN,o.ORDERSUUID from returnorders o inner join sys_emp u1 on o.creater=u1.uuid left join sys_emp as u2 on o.checker =u2.uuid left join  sys_emp u3 on o.ender=u3.uuid left join  supplier s1 on o.supplieruuid=s1.uuid where o.state ='h'
  </select>

  <select id="queryReturnorderdetailAllListtype" resultType="java.util.Map">
select o.uuid,date_format(o.createtime,'%Y-%m-%d %H:%i:%s') as createtime,
             date_format(o.checktime,'%Y-%m-%d %H:%i:%s') as checktime,
             date_format(o.endtime,'%Y-%m-%d %H:%i:%s') as endtime, u1.name as creatername,u2.name as checkername ,u3.name as endername ,s1.name as suppliername,o.TOTALMONEY,o.STATE,o.WAYBILLSN,o.ORDERSUUID from returnorders o inner join sys_emp u1 on o.creater=u1.uuid left join sys_emp as u2 on o.checker =u2.uuid left join  sys_emp u3 on o.ender=u3.uuid left join  supplier s1 on o.supplieruuid=s1.uuid where o.type =2 and state ='y'
  </select>

  <select id="queryByreturnid" resultType="com.upup.purchase.model.Returnorderdetail">
    select * from returnorderdetail where ordersuuid = #{orderuuid}
  </select>

  <select id="queryByglyuuidAll" resultType="com.upup.model.Store">
    	select * from store where sys_empUUID =#{glyuuid}
  </select>

  <select id="selectcangkudetauiluuid" resultType="com.upup.stock.model.Storedetail">
    select * from storedetail where STOREUUID=#{storeuuid} and GOODSUUID =#{goodsuuid}
  </select>

  <update id="updateReturndetailstateH">
      update returnorderdetail set state ='h' where uuid =#{ordersuuid}
  </update>

  <!--&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&-->
  <select id="selectgetByhenduo" resultType="java.lang.Integer">
      select uuid from storedetail where storeuuid=
      (select uuid from store where name = #{param1} and sys_empUUID = #{param2} ) and goodsuuid = #{param3}
    </select>
  <select id="selectcangkuuuid" resultType="java.lang.Integer">
    select uuid from store where name = #{storename} and sys_empUUID = #{glyuuid}
  </select>

  <update id="updateNumJian">
        update storedetail set num=num -#{param1} where uuid =#{param2}
  </update>

  <update id="updateOrdersDetail">
    update orderdetail set state = 2 where uuid =#{uuid}
  </update>

  <update id="updateOrderscjstate">
    update orders set state =2 where uuid = #{ordersuuid}
  </update>

  <insert id="insertOrderssj">
    insert into orders(uuid,CREATETIME,type,creater,TOTALMONEY,state,SUPPLIERUUID) values(#{uuid},#{CREATETIME},#{type},#{creater},#{TOTALMONEY},#{state},#{SUPPLIERUUID})
  </insert>

  <insert id="insertOrderxiangxi">
    insert into orderdetail (GoodsuuId, Goodsname,
    Price, Num, Money,
    ORDERSUUID,STATE)
    values
    <foreach collection="orderDetailList" item="list" separator=",">
      (#{list.orderdetailGoodsId},
      #{list.orderdetailGoodname},
      #{list.orderdetailPrice},
      #{list.orderdetailNum},
      #{list.orderdetailMoney},
      #{orderid},
      1
      )
    </foreach>

  </insert>
  <update id="updatereturn">
      update orderdetail set STATE = 't' where uuid = #{uuid}
  </update>

  <insert id="insertreturnorders">
    insert into returnorders(CREATETIME,TYPE,CREATER,SUPPLIERUUID,TOTALMONEY,STATE,WAYBILLSN) values
     (#{CREATETIME},#{TYPE},#{CREATER},#{SUPPLIERUUID},#{TOTALMONEY},#{STATE},#{WAYBILLSN})
  </insert>

  <select id="queryStateListString" resultType="java.lang.String">
    select state as a from returnorderdetail where ordersuuid =#{ordersuuid} group by a
  </select>
  <select id="queryStateListStringss" resultType="java.lang.String">
    select state as a from orderdetail where ordersuuid =#{ordersuuid} group by a
  </select>
  <select id="queryReturnorderdetailAllListPage" resultType="java.util.Map">
    select o.uuid, date_format(o.createtime,'%Y-%m-%d %H:%i:%s') as createtime,
             date_format(o.checktime,'%Y-%m-%d %H:%i:%s') as checktime,
             date_format(o.endtime,'%Y-%m-%d %H:%i:%s') as endtime, u1.name as creatername,u2.name as checkername ,u3.name as endername ,s1.name as suppliername,TOTALMONEY,STATE,WAYBILLSN,ORDERSUUID from returnorders o inner join sys_emp u1 on o.creater=u1.uuid left join sys_emp as u2 on o.checker =u2.uuid left join  sys_emp u3 on o.ender=u3.uuid left join  supplier s1 on o.supplieruuid=s1.uuid where o.type =2
  </select>


  <update id="updatemonryjia">
    update returnorders set TOTALMONEY =TOTALMONEY+#{money} where WAYBILLSN =#{orderuuid}
  </update>

  <insert id="insertreturnordersdetail">
     insert into returnorderdetail (GoodsuuId, Goodsname,
    Price, Num, Money,
    ORDERSUUID,STATE)
    values
    (#{goodsuuid},#{goodsname},#{price},#{num},#{money},#{ordersuuid},#{state})

  </insert>

  <update id="updatesetstateY">
    update  returnorderdetail set state = 'y' where ordersuuid=#{orderuuid}
  </update>

  <update id="updatesetreturnOrders">
    update  returnorders set state = 'y', CREATER = #{glyuuid},CHECKTIME=#{shijian} where uuid=#{orderuuid}
  </update>
  <update id="updateStoreJia">
 update storedetail set num=num +#{num} where uuid =#{storedetailuuid}
  </update>

  <update id="updateStoreJian">
 update storedetail set num=num -#{num} where uuid =#{storedetailuuid}
  </update>

  <update id="updatereturnorderssetstateH">
    update returnorders set state = 'h' where uuid = #{ordersuuid}
  </update>




  <!--&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&-->


<!---->
    <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    delete from goods
    where UUID = #{uuid,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.upup.sale.model.Goods" >
    insert into goods (UUID, NAME, ORIGIN, 
      PRODUCER, UNIT, INPRICE, 
      OUTPRICE, GOODSTYPEUUID)
    values (#{uuid,jdbcType=INTEGER}, #{name,jdbcType=VARCHAR}, #{origin,jdbcType=VARCHAR}, 
      #{producer,jdbcType=VARCHAR}, #{unit,jdbcType=VARCHAR}, #{inprice,jdbcType=REAL}, 
      #{outprice,jdbcType=REAL}, #{goodstypeuuid,jdbcType=INTEGER})
  </insert>
  <insert id="insertSelective" parameterType="com.upup.sale.model.Goods" >
    insert into goods
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="uuid != null" >
        UUID,
      </if>
      <if test="name != null" >
        NAME,
      </if>
      <if test="origin != null" >
        ORIGIN,
      </if>
      <if test="producer != null" >
        PRODUCER,
      </if>
      <if test="unit != null" >
        UNIT,
      </if>
      <if test="inprice != null" >
        INPRICE,
      </if>
      <if test="outprice != null" >
        OUTPRICE,
      </if>
      <if test="goodstypeuuid != null" >
        GOODSTYPEUUID,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="uuid != null" >
        #{uuid,jdbcType=INTEGER},
      </if>
      <if test="name != null" >
        #{name,jdbcType=VARCHAR},
      </if>
      <if test="origin != null" >
        #{origin,jdbcType=VARCHAR},
      </if>
      <if test="producer != null" >
        #{producer,jdbcType=VARCHAR},
      </if>
      <if test="unit != null" >
        #{unit,jdbcType=VARCHAR},
      </if>
      <if test="inprice != null" >
        #{inprice,jdbcType=REAL},
      </if>
      <if test="outprice != null" >
        #{outprice,jdbcType=REAL},
      </if>
      <if test="goodstypeuuid != null" >
        #{goodstypeuuid,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>



  <update id="updateByPrimaryKeySelective" parameterType="com.upup.sale.model.Goods" >
    update goods
    <set >
      <if test="name != null" >
        NAME = #{name,jdbcType=VARCHAR},
      </if>
      <if test="origin != null" >
        ORIGIN = #{origin,jdbcType=VARCHAR},
      </if>
      <if test="producer != null" >
        PRODUCER = #{producer,jdbcType=VARCHAR},
      </if>
      <if test="unit != null" >
        UNIT = #{unit,jdbcType=VARCHAR},
      </if>
      <if test="inprice != null" >
        INPRICE = #{inprice,jdbcType=REAL},
      </if>
      <if test="outprice != null" >
        OUTPRICE = #{outprice,jdbcType=REAL},
      </if>
      <if test="goodstypeuuid != null" >
        GOODSTYPEUUID = #{goodstypeuuid,jdbcType=INTEGER},
      </if>
    </set>
    where UUID = #{uuid,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.upup.sale.model.Goods" >
    update goods
    set NAME = #{name,jdbcType=VARCHAR},
      ORIGIN = #{origin,jdbcType=VARCHAR},
      PRODUCER = #{producer,jdbcType=VARCHAR},
      UNIT = #{unit,jdbcType=VARCHAR},
      INPRICE = #{inprice,jdbcType=REAL},
      OUTPRICE = #{outprice,jdbcType=REAL},
      GOODSTYPEUUID = #{goodstypeuuid,jdbcType=INTEGER}
    where UUID = #{uuid,jdbcType=INTEGER}
  </update>



</mapper>